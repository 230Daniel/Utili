@page
@using Database.Data
@model UtiliSite.Pages.Premium.IndexModel
@{
    Layout = "Shared/_Layout.cshtml";
    if (ViewData["subscriptions"] is null) { return; }
    List<SubscriptionsRow> subscriptions = (List<SubscriptionsRow>)ViewData["subscriptions"];
    ViewData["Title"] = "Premium - Utili";
}

<div class="text-center text-white">
    <h1 class="display-4">Premium</h1>
    <p style="margin-bottom: 40px;">Help cover operating costs and get some sweet benefits in return</p>
</div>

<p class="text-white noverticalmargin">You'll get...</p>
<div class="premium-benefits">
    <p>
        • <b>Autopurge:</b> Purge 5 channels every 10 seconds instead of 1 channel every 30 seconds
    </p>
    <p>
        • <b>Role Linking:</b> Remove the limit of 2 rules
    </p>
    <p>
        • <b>Inactive role:</b> Add the option to automatically kick inactive users after an additional threshold
    </p>
    <p>
        • <b>Message logs:</b> Remove the limit of 50 messages per channel
    </p>
    <p>
        • <b>Vote channels:</b> Increase the limit from 2 emojis per channel to 5 emojis per channel
    </p>
    <p>
        • <b>Bonus:</b> Get a coloured role on the Utili discord server
    </p>
</div>


@if (subscriptions.Count > 0)
{
    int valid = subscriptions.Count(x => x.IsValid);
    int canceled = subscriptions.Count(x => x.Status == SubscriptionStatus.Canceled || x.Status == SubscriptionStatus.IncompleteExpired);
    int overdue = subscriptions.Count(x => x.Status == SubscriptionStatus.PastDue);
    int incomplete = subscriptions.Count(x => x.Status == SubscriptionStatus.Incomplete);
    int slots = subscriptions.Where(x => x.IsValid).Sum(x => x.Slots);

    <div class="divider">
        <div></div>
        <span>Your Subscriptions</span>
    </div>

    if (canceled > 0) { <span class="text-white">You have @canceled canceled @(canceled == 1 ? "subscription" : "subscriptions")</span> }
    if (overdue > 0) { <span class="text-danger">You have @overdue overdue @(overdue == 1 ? "subscription" : "subscriptions")</span> }
    if (incomplete > 0) { <span class="text-danger">You have @incomplete incomplete @(incomplete == 1 ? "subscription" : "subscriptions")</span> }
    <p class="text-white">You have @valid active @(valid == 1 ? "subscription" : "subscriptions") with a total of @slots premium server @(slots == 1 ? "slot" : "slots"). </p>
    if (slots > 0) { <a class="a-blue" href="@RedirectHelper.AddToUrl(ViewContext, "servers")">Select @(slots == 1 ? "server" : "servers") ➔</a> <br /> }
    <span class="a-blue" onclick="billingPortal()">Manage Billing ➔</span>
}

<div class="divider">
    <div></div>
    <span>Premium Plans</span>
</div>

<div class="plan-container" align="center" vertical-align="top">
    <div class="plan">
        <div class="plan-content">
            <p class="plan-title">1 Server</p>
            <p class="plan-description">One Utili Premium slot for a server of your choice</p>
            <p class="plan-price" id="price-1">£1.50</p>
            <p class="plan-price-small">per month</p>
            <p class="plan-price-per" id="price-1-per">£1.50 / server</p>
            <div class="plan-order-button" id="order-1" onclick="checkout(1, $('#currencySelect').val());">
                Subscribe
            </div>
        </div>
    </div>

    <div class="plan plan-highlighted">
        <div class="plan-content">
            <p class="plan-highlighted-text">Popular</p>
            <p class="plan-title">3 Servers</p>
            <p class="plan-description">Three Utili Premium slots for servers of your choice</p>
            <p class="plan-price" id="price-3">£3.75</p>
            <p class="plan-price-small">per month</p>
            <p class="plan-price-per" id="price-3-per">£1.25 / server</p>
            <div class="plan-order-button" id="order-3" onclick="checkout(3, $('#currencySelect').val());">
                Subscribe
            </div>
        </div>
    </div>

    <div class="plan">
        <div class="plan-content">
            <p class="plan-title">5 Servers</p>
            <p class="plan-description">Five Utili Premium slots for servers of your choice</p>
            <p class="plan-price" id="price-5">£5.00</p>
            <p class="plan-price-small">per month</p>
            <p class="plan-price-per" id="price-5-per">£1.00 / server</p>
            <div class="plan-order-button" onclick="checkout(5, $('#currencySelect').val());">
                Subscribe
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    changeCurrency();
</script>