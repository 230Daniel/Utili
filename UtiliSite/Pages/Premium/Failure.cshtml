@page
@using Database.Data
@model UtiliSite.Pages.Premium.FailureModel
@{
    Layout = "Shared/_Layout.cshtml";

    List<SubscriptionsRow> subscriptions = (List<SubscriptionsRow>)ViewData["subscriptions"];

    ViewData["Title"] = "Failure - Utili Premium";
}

<div class="text-center text-white" style="margin-bottom: 30px;">
    <h1 class="display-4">Payment Failed</h1>
</div>

<div class="text-white">
    Sorry, something went wrong while activating your subscription. <br/>
    Please <a href="@RedirectHelper.GoToPage(ViewContext, "contact")" class="a-blue">contact us</a> so we can resolve the problem or click on Manage Billing below to check your payment methods.
</div>

@if (subscriptions.Count > 0)
{
    int valid = subscriptions.Count(x => x.IsValid);
    int canceled = subscriptions.Count(x => x.Status == SubscriptionStatus.Canceled || x.Status == SubscriptionStatus.IncompleteExpired);
    int overdue = subscriptions.Count(x => x.Status == SubscriptionStatus.PastDue);
    int incomplete = subscriptions.Count(x => x.Status == SubscriptionStatus.Incomplete);
    int slots = subscriptions.Where(x => x.IsValid).Sum(x => x.Slots);

    <div class="divider">
        <div></div>
        <span>Your Subscriptions</span>
    </div>

    if (canceled > 0) { <span class="text-white">You have @canceled canceled @(canceled == 1 ? "subscription" : "subscriptions")</span> }
    if (overdue > 0) { <span class="text-danger">You have @overdue overdue @(overdue == 1 ? "subscription" : "subscriptions")</span> }
    if (incomplete > 0) { <span class="text-danger">You have @incomplete incomplete @(incomplete == 1 ? "subscription" : "subscriptions")</span> }
    <p class="text-white">You have @valid active @(valid == 1 ? "subscription" : "subscriptions") with a total of @slots premium server @(slots == 1 ? "slot" : "slots"). </p>
    if (slots > 0) { <a class="a-blue" href="@RedirectHelper.AddToUrl(ViewContext, "servers")">Select @(slots == 1 ? "server" : "servers") ➔</a> <br /> }
    <span class="a-blue" onclick="billingPortal()">Manage Billing ➔</span>
}